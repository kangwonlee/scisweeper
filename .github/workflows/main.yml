name: Python package

on: [push]

jobs:
  run: 
    runs-on: ${{ matrix.operating-system }}
    strategy:
      max-parallel: 4
      matrix:
        operating-system: [ubuntu-latest]
        python-version: [2.7, 3.6, 3.7]
    steps:
    - uses: actions/checkout@v1
    - name: install dependencies and test
      env:
        PYVER: ${{ matrix.python-version }}
      run: |
        export PATH="$CONDA/bin:$PATH"
        echo "conda init bash ========================"
        conda init bash
        echo ". ~/.bashrc ============================"
        . ~/.bashrc
        echo "conda update -q conda =================="
        conda update -q conda
        echo "conda create ==========================="
        conda env create -n scisweeper -q --yes -c conda-forge coverage pandas scandir h5io numpy pysqa tqdm pip python=${PYVER}
        echo "conda activate scisweeper =============="
        conda activate scisweeper
        echo "pip install --pre ======================"
        pip install --pre .
        conda list
        echo "test ==================================="
        coverage run -m unittest discover tests
